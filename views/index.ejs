<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Audit</title>
  <!-- Add Raleway font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,500,600,700&display=swap" rel="stylesheet">
  <!-- Add Poppins font -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap" rel="stylesheet">
  <style>
    body, .btn, .form-control, .company-info, .info-label, .info-value, .category-title, .question-text, .summary-title, .admin-link, .score-badge, .total-score, .main-container, .panels-container, .summary-panel, .info-panel, .question-score-badge, .category-score-badge, .comment-input, .add-image-label, .no-questions, .admin-button, .header-content, .company-section, .logo, .company-info h1, .company-info p, .action-buttons, .question-controls, .radio-option, .badge, .summary-table, .image-modal-box, .image-modal-content, .image-modal-img, .image-modal-close, .question-footer, .header-btn, .score-section, .button-group, .mobile-menu-icon, .mobile-dropdown, .admin-label, .remark-box {
      font-family: 'Poppins', Arial, Helvetica, sans-serif !important;
    }
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', Arial, Helvetica, sans-serif !important;
      font-weight: 600;
      letter-spacing: 0.01em;
    }
  </style>
  
  <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/indstyle.css">
</head>
<body>
  
 <!-- <header class="header">
  <div class="mobile-menu-icon" onclick="toggleMobileMenu()">
  &#x22EE; Unicode for vertical three dots -->
<!-- </div> -->

<!-- Dropdown Menu -->
<!-- <div id="mobileDropdown" class="mobile-dropdown hidden">
  <a href="/dashboard">Dashboard</a>
  <a href="editCompany(')">Admin</a>
</div> --> 
 <header class="bg-dark text-white p-2 py-3 sticky-top shadow-sm z-3">
  <div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-dark p-0">
      <!-- Left: Logo + Title -->
      <div class="d-flex align-items-center">
        <img src="/images/logo.png" alt="Company Logo" height="80" class="me-2" />
        
        <div class="d-none d-sm-block px-3">
          <h5 class="mb-0 fw-bold">Food Safety Auditing</h5>
          <small class="d-sm-block">Company Audit Portal</small>
        </div>
      </div>

      <!-- Spacer -->
      <div class="flex-grow-1"></div>

      <!-- Mobile Score + Menu (Same row) -->
      <div class="d-lg-none d-flex align-items-center gap-2 ms-auto">
        <!-- Horizontal compact score -->
        <div class="text-white px-2 py-1 rounded small d-flex align-items-center" style="font-size: 0.8rem;" id="score-bb">
          Total: <span id="totalScore" class="ms-1"></span> (<span id="totalScorePercent"></span>)
        </div>

        <!-- Hamburger Button -->
        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <!-- Collapsible Menu -->
      <div class="collapse navbar-collapse " id="navbarMenu">
        <ul class="navbar-nav ms-auto d-flex align-items-center gap-2" id="navButtonGroup">
          <!-- Desktop Score -->
          <!-- Desktop Score - Horizontal Layout -->
            <li class="nav-item d-none d-lg-flex align-items-center  text-white px-3 py-2 rounded me-3 gap-3 small fw-semibold" id="score-bb">
              <div>Score</div>
              <span id="totalScoreDesktop">3</span>
              <span id="totalScoreDetails">3 / 3 (100%)</span>
            </li>

          <!-- Generate PDF Button -->
          <li class="nav-item">
            <button class="btn btn-primary fw-semibold px-3 py-1 me-2" target="_blank" id="exportPdfBtn">
               Save PDF
            </button>
          </li>

          <!-- Buttons -->
          <li class="nav-item">
            <a href="/" class="text-white text-decoration-underline small fw-semibold border-0 bg-transparent nav-btn-custom">Dashboard</a>
          </li>
          <li class="nav-item">
            <button onclick="editCompany('<%= company._id %>')" class="text-white text-decoration-underline bg-transparent border-0 small fw-semibold nav-btn-custom" id="btn-edit">Edit Form</button>
          </li>
          <li class="nav-item">
            <a href="/auth/login" class="text-white text-decoration-underline small fw-semibold border-0 bg-transparent nav-btn-custom">Logout</a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</header>






  <div class="container-fluid px-2 px-md-4 mt-4">
    <div class="row g-4">
      <div class="col-12">
        <div class="info-panel w-100">
          <div class="info-grid">
            <div class="info-item"><span class="info-label">Company:</span> <span class="info-value" name="company" ></span></div>
            <div class="info-item"><span class="info-label">Location:</span> <span class="info-value" name="location" ></span></div>
            <div class="info-item"><span class="info-label">Date:</span> <span class="info-value" name="date"></span></div>
            <div class="info-item"><span class="info-label">Branch:</span> <span class="info-value" name="branch"></span></div>
            <div class="info-item"><span class="info-label">Manager:</span> <span class="info-value" name="manager"></span></div>
            <div class="info-item"><span class="info-label">Inspector:</span> <span class="info-value" name="inspector"></span></div>
          </div>
          <button id="toggle-edit-btn"  style="margin-top:20px;">Edit info</button>
        </div>
      </div>
      <div class="col-12">
        <div class="summary-panel w-100">
          <h4 class="summary-title">
            <i class="fas fa-chart-bar me-2"></i>
            Quick Summary
          </h4>
          <div class="table-responsive">
            <table class="table table-hover summary-table" id="summaryTable">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Score</th>
                  <th>Percentage</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="summaryTableBody">
                <!-- Dynamic rows will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="main-container">
    <main>
      <% if (categories && categories.length) { %>
        <% categories.forEach(function(cat) { %>
          <div class="category-card" data-category-id="<%= cat._id %>">
            <div class="category-header">
              <div class="category-title">
                <%= cat.name %>
                <span class="category-score-badge category-score" data-category-id="<%= cat._id %>">0/0 (0%)</span>
              </div>
            </div>
            <ul class="questions-list">
              <% questions.filter(q => q.category && q.category._id.toString() === cat._id.toString()).sort((a, b) => a.order - b.order).forEach(function(q, idx) { %>
                <li class="question-item" data-category-id="<%= cat._id %>" data-question-id="<%= q._id %>">
                  <form method="POST" action="/audit/answer/<%= q._id %>" enctype="multipart/form-data" class="question-form">
                    <div class="question-content">
                      <div class="question-text"><%= idx + 1 %>. <%= q.text %></div>
                      <div class="question-controls">
                        <div class="radio-group">
                          <div class="radio-option">
                            <input type="radio" name="response-<%= q._id %>" value="yes" id="<%= q._id %>-yes" data-score="1">
                            <label for="<%= q._id %>-yes">Yes</label>
                          </div>
                          <div class="radio-option">
                            <input type="radio" name="response-<%= q._id %>" value="no" id="<%= q._id %>-no" data-score="0">
                            <label for="<%= q._id %>-no">No</label>
                          </div>
                          <div class="radio-option">
                            <input type="radio" name="response-<%= q._id %>" value="na" id="<%= q._id %>-na" data-score="0">
                            <label for="<%= q._id %>-na">N/A</label>
                          </div>
                        </div>
                        <!-- New wrapper for Add Image + Score Badge -->
                          <div class="question-footer">
                            <!-- <label class="add-image-label">
                              ðŸ“· Add image
                              <input type="file" name="images" class="hidden-file-input" accept="image/*">
                            </label> -->
                                <button type="button" class="open-image-options button-46" data-question-id="<%= q._id %>">
                                  ðŸ“· Add image
                                </button>
                        
                          </div>
                        </div>
                    </div>
                    <input type="text" class="comment-input" placeholder="Add your comments here..." name="comment" autocomplete="off">
                    

                    <div class="image-preview" data-question-id="<%= q._id %>"></div>
                  </form>
                </li>
              <% }) %>
            </ul>
          </div>
        <% }) %>
      <% } else { %>
        <div class="no-questions">
          <h3>No audit questions available</h3>
          <p>Please add categories and questions to get started.</p>
          <a href="/admin" class="admin-link">Go to Admin Panel</a>
        </div>
      <% } %>
    </main>
    <!-- ðŸ“· Image Upload Modal -->
<div id="imageOptionModal" class="image-modal-overlay">
  <div class="image-modal-box">
    <h4>Select Image Option</h4>
    <button id="uploadFileBtn">Upload from device</button>
    <button id="captureCameraBtn">Capture from camera</button>
    <input type="file" id="hiddenImageInput" class="hidden" accept="image/*">
    <button id="closeImageModal">Cancel</button>
  </div>
</div>

  </div>

  <div id="imageModal" class="image-modal">
    <div class="image-modal-content">
      <button class="image-modal-close" id="closeModalBtn">&times;</button>

      <img src="" alt="Preview" class="image-modal-img" id="imageModalImg">
    </div>
  </div>
<div class="action-buttons">
    <button id="clearAllBtn"> Clear All</button>
    <button id="exportPdfBtnBottom"> Save PDF</button>
</div>
<!-- <button class="button" id="scrollTopBtn">
  <svg class="svgIcon" viewBox="0 0 384 512">
     <path
      d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"
    ></path> 
  </svg>
</button> -->
<button id="scrollTopBtn" title="Go to top">
  â†‘
</button>
<script src="/scripts/index.js"></script>
 <script>
  const scrollTopBtn = document.getElementById("scrollTopBtn");

  // Show button after scrolling down
  window.addEventListener("scroll", () => {
    if (window.scrollY > 300) {
      scrollTopBtn.classList.add("show");
    } else {
      scrollTopBtn.classList.remove("show");
    }
  });

  // Scroll to top when button is clicked
  scrollTopBtn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 </body>
 </html>